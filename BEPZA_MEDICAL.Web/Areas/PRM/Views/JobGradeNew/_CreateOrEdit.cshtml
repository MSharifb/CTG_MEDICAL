@model BOM_MPA.Web.Areas.PRM.ViewModel.SalaryScaleViewModel
@using BOM_MPA.Web.Helpers

<script src="@Url.Content("~/Scripts/listEditor.js")" type="text/javascript"></script>


<div class="GroupBox">
    <div class="row">
        <span class="label">
            @Html.HiddenFor(model => model.IUser)
            @Html.HiddenFor(model => model.IDate)
            @Html.HiddenFor(model => model.EUser)
            @Html.HiddenFor(model => model.EDate)

            @Html.LabelFor(model => model.SalaryScaleName)
            <label style='color: red'>*</label>
        </span>
        <span class="field">
            @Html.EditorFor(model => model.SalaryScaleName)
        </span>
        <span class="label-right">
        </span>
        <span class="field">
        </span>
    </div>
    <div class="row">
        <span class="label">
            @Html.LabelFor(model => model.DateOfCirculation)
            <label style='color: red'>*</label>
        </span>
        <span class="field">
            @Html.EditorFor(model => model.DateOfCirculation)
        </span>
        <span class="label-right">
            @Html.LabelFor(model => model.DateOfEffective)
            <label style='color: red'>*</label>
        </span>
        <span class="field">
            @Html.EditorFor(model => model.DateOfEffective)
        </span>
    </div>
    <div class="clear">
    </div>
</div>

<div class="GroupBox">
    @Html.Partial("_JobGrades", Model)
</div>

@*<div class="GroupBox">
    <div class="row" align="center">
        <div style="width: 30%">
            <table id="grid" class="contenttable" width="50%">
                <thead>
                    <tr>
                        <th width="30%" align="center">
                            Step No.
                            <label style='color: red; font-weight: normal;'> * </label>
                        </th>
                        <th width="70%" align="center">
                            Step Amount
                            <label style='color: red; font-weight: normal;'> * </label>
                        </th>
                    </tr>
                </thead>


                @Html.Partial("_GradeSteps", Model)*@



                @*@if (Model != null && Model.JobGradeViewModel.GradeStep != null)
                    {
                        foreach (var x in Model.JobGradeViewModel.GradeStep.OrderBy(t => t.StepName))
                        {
                            @Html.Partial("_GradeSteps", x);
                        }
                    }*@
            @*</table>
        </div>
    </div>
</div>*@




@*<div class="button-center buttonSubmit">
        @if ((new BOM_MPA.Web.Utility.AppConstant()).IsAddAssigned)
        {
            <input type="submit" value="Save" style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" />
        }

        <input type="button" value="Clear" id="btnClear" name="btnClear" />
    </div>*@



<div class="GroupBox">
    <div class="row" align="center">
        
        <div style="width:50%">
            <div class="button-crude fixedAddButton" style="text-align: right;">
                <input id="btnAdd" type="button" value="Add" />
                <input id="btnChildUpdate" type="button" value="Update" style="display: none;" />
            </div>
            <div class="clear">
            </div>
            <table id="grid" class="contenttable fixedcontenttable">
                <thead>
                    <tr>
                        <th>
                            Step No
                        </th>
                        <th>
                            Step Ammount
                        </th>
                        <th>
                            Remove
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.JobGradeViewModel.GradeStep.Count; i++)
                    {
                        var item = Model.JobGradeViewModel.GradeStep.ToList()[i];
                        <tr class="row">
                            <td style="display: none;">
                                <input type="text" name="@("JobGradeViewModel.GradeStep[" + i + "].Id")" value="@item.Id" />
                            </td>
                            <td>
                                <input type="text" name="@("JobGradeViewModel.GradeStep[" + i + "].StepName")" value="@item.StepName" />
                            </td>
                            <td>
                                <input style="text-align:right" type="text" name="@("JobGradeViewModel.GradeStep[" + i + "].StepAmount")" value="@item.StepAmount" />
                            </td>
                            <td>
                                <a class="deleteRow fixeddeleteRow" title="delete" href="#">
                                    <img alt="delete" style="border: none;" src="@Url.Content("~/Content/Images/Delete.png")" />
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        
    </div>

</div>
<br />
<div class="clear">
</div>


<div class="GroupBox">

    <table id="jqGridJobGrade" cellpadding="0" cellspacing="0"></table>
    <div id="jqGridJobGradePager" style="text-align: center;">
    </div>
    <div id="divList">
        <div id='delete-dialog' title='Delete Record' style="height: 20px">
            <p style="line-height: 1em">
                <span class='ui-icon ui-icon-alert' style='float: left; margin: 0 7px 20px 0;'></span>
                Do you want to delete this record?
            </p>
        </div>
        @Html.Partial("_GridListJobGrade")
    </div>
</div>



<script type="text/javascript">

    $(function () {
        var Url = window.location.href;
        $("#btnClear").live("click", function (event) {
            event.preventDefault();
            window.location.href = Url;
        });
    });

    @*function AddNewRow(noofSteps) {

        $('.dynamicRow').each(function () {
            $(this).remove();
        })

        var url = '@Url.Action("AddDetail", "JobGradeNew")'
        for (a = 0; a < noofSteps; a++) {
            var table = $('#grid')
            $.ajax({
                url: url,
                cache: false,
                success: function (html) {
                    $(table).append(html);
                },
                complete: function () {
                    $('.dynamicRow').each(function () {
                        $(this).find('td:first').find('input:first').val($(this).index());

                    })
                }
            });
        }
    }*@

    function AddNewRow(noofSteps) {

        $('.dynamicRow').each(function () {
            $(this).remove();
        })

        var url = '@Url.Action("AddDetail", "JobGradeNew", new { stepNo = "_stepNo_" })'
        url = url.replace(/_stepNo_/, noofSteps);
        //for (a = 0; a < noofSteps; a++) {
        var table = $('#grid')
        $.ajax({
            url: url,
            cache: false,
            success: function (html) {
                //alert(html);
                $(table).append(html);
            },
            complete: function () {
                //$('.dynamicRow').each(function () {
                //    $(this).find('td:first').find('input:first').val($(this).index());

                //})
            }
        });
        //}
    }

    function AutoCalculateLastBasic() {
        var initialBasic = $("#InitialBasic").val();
        var numberOfSteps = $("#NumberOfSteps").val();
        var incrementAmount = $("#YearlyIncrement").val();
        if (initialBasic != "" && numberOfSteps != "" && incrementAmount != "") {
            $("#LastBasic").val(parseFloat(initialBasic) + (parseFloat(numberOfSteps - 1) * parseFloat(incrementAmount)));
        }
    }

    $(function () {

        $("#LastBasic").css('background-color', '#F2F5F8');

        if ('@Model.IsUsed' == 'True') {
            $('#NumberOfSteps').attr('readonly', true)
            $('#NumberOfSteps').css('background-color', '#F2F5F8');
        }
        else {
            $('#NumberOfSteps').attr('readonly', false)
        }

        $("#YearlyIncrement").keyup(function () {
            AutoCalculateLastBasic();
        });
        $("#InitialBasic").keyup(function () {
            AutoCalculateLastBasic();
        });
        $("#NumberOfSteps").keyup(function () {
            AutoCalculateLastBasic();
        });
        $(".addItem").click(function () {
            $(".validation-summary-errors ").empty();
        });

        $("#IsConsolidated").click(function () {

            if ($('#IsConsolidated').is(':checked')) {
                $('#NumberOfSteps').val(1); AddNewRow(1);
                $('#InitialBasic,#YearlyIncrement,#LastBasic').val(0);
                $('#NumberOfSteps,#InitialBasic,#YearlyIncrement,#LastBasic').attr('readonly', true);
                $('#NumberOfSteps,#InitialBasic,#YearlyIncrement,#LastBasic').addClass('read-only');
            }
            else {
                $('#NumberOfSteps,#InitialBasic,#YearlyIncrement,#LastBasic').attr('readonly', false);
                $('#NumberOfSteps,#InitialBasic,#YearlyIncrement,#LastBasic').removeClass('read-only');
            }
        });

        if ('@Model.JobGradeViewModel.IsConsolidated' == 'True') {
            $('#NumberOfSteps,#InitialBasic,#YearlyIncrement,#LastBasic').attr('readonly', true);
            $('#NumberOfSteps,#InitialBasic,#YearlyIncrement,#LastBasic').addClass('read-only');
        }
    });

    $(document).ready(function () {

        //$('#JobGradeViewModel_NumberOfSteps').live("blur", function () {
        //    var Value = $(this).val();

        //    if (Value <= 30) {
        //        $('#message').html('');
        //        AddNewRow(Value);
        //    }
        //    else {
        //        $('#message').html("<b style='color:Red'>" + 'Grade Step shall not more then 30 !' + "</b>");
        //    }
        //});

        if ('@Model.IsError' == '1') {

            if ('@Model.IsError' == "1") {
                $('#message').html("<b style='color:Red'>" + '@Model.ErrMsg' + "</b>");
            }
            else {
                $('#message').html("<b style='color:Green'>" + '@Model.ErrMsg' + "</b>");
            }
        }
    });

</script>
