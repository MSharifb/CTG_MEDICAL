@model BEPZA_MEDICAL.Web.Areas.PRM.ViewModel.EmployeeMappingViewModel
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>

<div class="GroupBox">
    <div class="row">
        <span class="label" style="width: 500px">
            @Html.RadioButtonFor(model => model.Type, "Internal", new { id = "Internal", @class = "type" })
            <label for="paiement_cash">
                Internal Resource</label>
            &nbsp;
            @Html.RadioButtonFor(model => model.Type, "External", new { id = "External", @class = "type" })
            <label for="paiement_cash">
                External Resource/Consultant</label>            
        </span>
    </div>
    <div class="row">
        <span class="label">
            @Html.LabelFor(model => model.ResourceTypeId)
            <label class="required-field">
                *</label>
        </span><span class="field">
            @Html.DropDownListFor(model => model.ResourceTypeId, Model.ResourceTypeList, @String.Format("{0}", Content.DDLOptionalLabel()), new { @class = "required", onchange = "LoadResourceCategory();" })        
        </span>
    </div>
    <div class="row">
        <span class="label">
            @Html.LabelFor(model => model.ResourceCategoryId)
            <label class="required-field">
                *</label>
        </span><span class="field">
            @Html.DropDownListFor(model => model.ResourceCategoryId, Model.ResourceCategoryList, @String.Format("{0}", Content.DDLOptionalLabel()), new { @class = "required" })
        </span>
    </div>
    <div class="clear">
    </div>
</div>
<div class="GroupBox">
    <div class="button-center buttonSubmit">
    @if ((new BEPZA_MEDICAL.Web.Utility.AppConstant()).IsAddAssigned)
    {
        <input type="submit" value="Save" id="btnSave" name="btnSubmit" style="margin-right: 8px;" />
    }
    @if ((new BEPZA_MEDICAL.Web.Utility.AppConstant()).IsEditAssigned)
    {
        <input type="submit" value="Update" id="btnUpdate" name="btnSubmit" style="margin-right: 8px;
            display: none" />
    }
    @if ((new BEPZA_MEDICAL.Web.Utility.AppConstant()).IsDeleteAssigned)
    {
        <input type="submit" value="Delete" id="btnDelete" name="btnSubmit" style="margin-right: 8px;
            display: none" />
    }
       
    </div>
</div>
<script type="text/javascript">
    $(function () {

        $('#btnSave').click(function (event) {
            event.preventDefault();
            var url = '@Url.Action("Create", "EmployeeMapping")';
            var form = $('#frm');
            var serializedForm = form.serialize();
            $.post(url, serializedForm, function (obj) {  //Post to action
                if (obj.Success) {
                    $("#message").html("<b>" + obj.Message + "</b>").css("color", "green");
                    ResetForm();
                    jQuery("#jqGrid").trigger("reloadGrid");
                }
                else {
                    $("#message").html("<b>" + obj.Message + "</b>").css("color", "red");
                }
            });
        })

        $('#btnUpdate').click(function (event) {
            event.preventDefault();
            var url = '@Url.Action("Edit", "EmployeeMapping")';
            var form = $('#frm');
            var serializedForm = form.serialize();
            $.post(url, serializedForm, function (obj) {  //Post to action
                if (obj.Success) {
                    $("#message").html("<b>" + obj.Message + "</b>").css("color", "green");
                    ResetForm();
                    jQuery("#jqGrid").trigger("reloadGrid");
                }
                else {
                    $("#message").html("<b>" + obj.Message + "</b>").css("color", "red");
                }
            });
        })

    });

</script>
<script type="text/javascript">
    $(document).ready(function () {
        GetTypeInfo();
        $('.type').live('click', function () {
            GetTypeInfo();
        });

        $("#btnDelete").live("click", function () {
            //deleteLinkObj = $(this);  //for future use
            $('#delete-dialog').dialog('open');
            return false; // prevents the default behaviour
        });

        $('#delete-dialog').dialog({
            autoOpen: false, width: 400, resizable: false, modal: true, //Dialog options
            overlay: {
                backgroundColor: '#000',
                opacity: 0.5
            },
            buttons: {
                "Yes": function () {
                    var Type = $('input:radio[name=Type]:checked').val();

                    var url = '@Url.Action("DeleteConfirmed","EmployeeMapping")';
                    var form = $('#frm');
                    var serializedForm = form.serialize();
                    $.post(url, serializedForm, function (obj) {  //Post to action

                        if (obj.Success) {
                            $('#message').html("<b style='color:Green'>" + obj.Message + "</b>");
                            GetTypeInfo();
                        }
                        else {
                            $("#message").html("<b>" + obj.Message + "</b>").css("color", "red");
                        }
                    });
                    $(this).dialog("close");
                },
                "No": function () {
                    $(this).dialog("close");
                }
            }
        });

    });


    //    function OnSubmitSuccess(obj) {
    //        if (obj.Success > 0) {
    //            $('#message').html("<b style='color:Green'>" + obj.Message + "</b>");
    //            GetTypeInfo();
    //        }
    //        else {
    //            $("#message").html("<b>" + obj.Message + "</b>").css("color", "red");            
    //        }
    //    }

    //    function OnSubmitFailure() {
    //        alert('Form Submit Error!');
    //    }

    function GetTypeInfo() {
        var Type = $('input:radio[name=Type]:checked').val();

        var url = '@Url.Action("Edit","EmployeeMapping")';
        var form = $('#frm');
        var serializedForm = form.serialize();

        $('#ResourceTypeId').val('');
        $('#ResourceCategoryId').val('');


        $.get(url, serializedForm, function (obj) {
            if (obj != null) {
                $("#ResourceTypeId").val(obj.ResourceTypeId);
                LoadResourceCategory();
                setTimeout(function () { $("#ResourceCategoryId").val(obj.ResourceCategoryId); }, 100);
                $('#btnSave').hide();
                $('#btnUpdate').show();
                $('#btnDelete').show();
            }
            else {
                $('#btnSave').show();
                $('#btnUpdate').hide();
                $('#btnDelete').hide();
            }
        }, "json");


    }

    function LoadResourceCategory() {
        var ResourceTypeId = $('#ResourceTypeId').val();
        var ResourceCategory = $('#ResourceCategoryId');
        ResourceCategory.empty();
        ResourceCategory.append($('<option/>', {
            value: '',
            text: '@Content.DDLOptionalLabel()'
        }));
        if (ResourceTypeId != null && ResourceTypeId != '') {
            $.getJSON('@Url.Action("LoadResourceCategory")', { Id: ResourceTypeId }, function (items) {
                $.each(items, function (index, item) {
                    ResourceCategory.append($('<option/>', {
                        value: item.Id,
                        text: item.ResourceCategory
                    }));
                });
            });
        }
    }

</script>